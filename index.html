<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="styles/index.css">
    <link rel="stylesheet" type="text/css" href="styles/common.css">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap/bootstrap.css">
    <script src="js/moment.js"></script>
    <script src="js/moment-precise-range.js"></script>
    <title>Stepan Trofimov</title>
</head>
<body class="h-100">
<div class="row w-50">
    <p class="h1 text-white-50">Stepan Trofimov</p>
</div>
<div class="row w-50">
    <p class="h2 text-white-50">Unreal Engine Developer</p>
</div>
<div class="w-100" id="projects_root"></div>
<div class="row w-50" id="companies_root"></div>
</body>
<script type="module">
    import ProjectBuilder from "./js/project-builder.js";
    import CompanyBuilder from "./js/company-builder.js";

    let getJSON = function (url, callback) {
        let xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function () {
            let status = xhr.status;
            if (status === 200) {
                callback(xhr.response)
            } else {
                console.log("FAILED")
                return null
            }
        };
        xhr.send();
    };

    let currentIndex = 0;
    let projects = [
        "data\\projects\\postworld.json",
        "data\\projects\\quidditch.json",
        "data\\projects\\vr-painter.json",
        "data\\projects\\interactive-map-eef.json",
        "data\\projects\\domont-360.json",
        "data\\projects\\research-spark-web-ar.json",
        "data\\projects\\apartment-tour-etalon-silver.json",
        "data\\projects\\marta-hub.json",
        "data\\projects\\sakhalin-ind.json",
        "data\\projects\\sakhalin-mp.json",
        "data\\projects\\secrets-honey-valley.json",
    ]

    let companies = [
        "data\\companies\\screwdriver-entertainment.json",
        "data\\companies\\rtu-it-lab.json",
        "data\\companies\\enter-vr.json",
        "data\\companies\\marta.json",
        "data\\companies\\magic-factory.json",
    ]

    let onReceiveProjectJson = (data) => {
        let projectBuilder = new ProjectBuilder();
        let project = projectBuilder.build(data);
        document.getElementById("projects_root").innerHTML += project;

        currentIndex++;
        if (projects.length === currentIndex) {
            currentIndex = 0;
            getJSON(companies[currentIndex], onReceiveCompanyJson);
            return;
        }

        getJSON(projects[currentIndex], onReceiveProjectJson);
    };

    let onReceiveCompanyJson = (data) => {
        let companyBuilder = new CompanyBuilder();
        let company = companyBuilder.build(data);
        document.getElementById("companies_root").innerHTML += company;

        currentIndex++;
        if (companies.length === currentIndex) return;

        getJSON(companies[currentIndex], onReceiveCompanyJson);
    };

    getJSON(projects[currentIndex], onReceiveProjectJson)

</script>
</html>
