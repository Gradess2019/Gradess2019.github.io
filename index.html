<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" type="text/css" href="styles/index.css">
    <link rel="stylesheet" type="text/css" href="styles/common.css">
    <link rel="stylesheet" type="text/css" href="styles/bootstrap/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="styles/animations/animate.css">
    <script src="js/moment.js"></script>
    <script src="js/moment-precise-range.js"></script>
    <title>Stepan Trofimov</title>
</head>
<body class="h-100">
<div class="row w-50 bg-idea rounded m-auto mb-5 border border-2 mt-4">
    <p class="h1 text-white-50">Stepan Trofimov</p>
    <p class="h2 text-white-50">Unreal Engine Developer</p>
    <p>
        <a class="link-warning text-decoration-none" target="_blank" rel="noopener noreferrer"
           href="https://www.linkedin.com/in/gradess/">LinkedIn</a>
        <a class="link-warning text-decoration-none" target="_blank" rel="noopener noreferrer"
           href="https://t.me/GradessUE">Telegram</a>
        <a class="link-warning text-decoration-none" target="_blank" rel="noopener noreferrer"
           href="mailto: trofimovjava@gmail.com">E-mail</a>
        <a class="link-warning text-decoration-none" target="_blank" rel="noopener noreferrer"
           href="https://github.com/Gradess2019">GitHub</a>
        <a class="link-warning text-decoration-none" target="_blank" rel="noopener noreferrer"
           href="https://gitlab.com/gradess">GitLab</a>
    </p>

</div>
<div class="m-auto w-50">
    <p class="h1 text-white-50">Projects</p>
</div>
<div class="w-100" id="projects_root"></div>
<div class="m-auto w-50">
    <p class="h1 text-white-50">Companies</p>
</div>
<div class="w-100" id="companies_root">
</div>
</body>
<script type="module">
    import ProjectBuilder from "./js/project-builder.js";
    import CompanyBuilder from "./js/company-builder.js";

    let projectsRoot = document.getElementById("projects_root");
    let companiesRoot = document.getElementById("companies_root");

    let checkVisibility = function () {
        [...projectsRoot.children, ...companiesRoot.children].forEach(child => {
            if (isInViewport(child)) {
                child.classList.add("animate__animated", "animate__backInLeft");
                child.classList.remove("invisible");
            }
        })
    };

    let getJSON = function (url, callback) {
        let xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.responseType = 'json';
        xhr.onload = function () {
            let status = xhr.status;
            if (status === 200) {
                callback(xhr.response)
            } else {
                console.log("FAILED")
                return null
            }
        };
        xhr.send();
    };

    let currentIndex = 0;
    let projects = [
        "data\\projects\\postworld.json",
        "data\\projects\\quidditch.json",
        "data\\projects\\vr-painter.json",
        "data\\projects\\interactive-map-eef.json",
        "data\\projects\\domont-360.json",
        "data\\projects\\research-spark-web-ar.json",
        "data\\projects\\apartment-tour-etalon-silver.json",
        "data\\projects\\marta-hub.json",
        "data\\projects\\sakhalin-ind.json",
        "data\\projects\\sakhalin-mp.json",
        "data\\projects\\secrets-honey-valley.json",
        "data\\projects\\ufl.json",
    ]

    let companies = [
        "data\\companies\\screwdriver-entertainment.json",
        "data\\companies\\rtu-it-lab.json",
        "data\\companies\\enter-vr.json",
        "data\\companies\\marta.json",
        "data\\companies\\magic-factory.json",
        "data\\companies\\strikerz-inc.json",
    ]


    let onReceiveProjectJson = (data) => {
        let projectBuilder = new ProjectBuilder();
        let project = projectBuilder.build(data);
        projectsRoot.innerHTML += project;
        checkVisibility();

        currentIndex++;
        if (projects.length === currentIndex) {
            currentIndex = 0;
            getJSON(companies[currentIndex], onReceiveCompanyJson);
            return;
        }

        getJSON(projects[currentIndex], onReceiveProjectJson);
    };

    let onReceiveCompanyJson = (data) => {
        let companyBuilder = new CompanyBuilder();
        let company = companyBuilder.build(data);
        companiesRoot.innerHTML += company;
        checkVisibility();

        currentIndex++;
        if (companies.length === currentIndex) return;

        getJSON(companies[currentIndex], onReceiveCompanyJson);
    };

    getJSON(projects[currentIndex], onReceiveProjectJson)

    function isInViewport(el) {
        const rect = el.getBoundingClientRect();

        let bottom = rect.bottom;
        if (bottom > 300) {
            bottom -= 300;
        }

        return (
            rect.top >= 0 &&
            rect.left >= 0 &&
            bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
            rect.right <= (window.innerWidth || document.documentElement.clientWidth)

        );
    }

    window.addEventListener("scroll", checkVisibility);
</script>
</html>
